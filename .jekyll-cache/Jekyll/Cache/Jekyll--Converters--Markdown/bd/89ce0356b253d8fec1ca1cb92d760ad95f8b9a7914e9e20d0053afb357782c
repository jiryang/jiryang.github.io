I"‘(<p>ì˜¤ëŠ˜ì€ tripletì„ ì´ìš©í•œ FaceNet ì´í›„ì˜ xxxFace ì‹œë¦¬ì¦ˆì— ëŒ€í•´ ì´ì•¼ê¸°ë¥¼ í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤. ì–‘ì´ ë§ìŠµë‹ˆë‹¤!<br />
FaceNetì— ëŒ€í•œ ì§€ë‚œ<a href="https://jiryang.github.io/2020/05/23/FaceNet-and-one-shot-learning/">í¬ìŠ¤íŠ¸</a>ì—ì„œ open-set face recognitionì— ëŒ€í•œ ë¬¸ì œë¥¼ ì´ì•¼ê¸°í–ˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ì¸ classificationì˜ ê²½ìš° ê° classì— assignëœ dataë¡œ ëª¨ë¸ì„ í•™ìŠµí•˜ê³ , unseen test dataë¥¼ ì–´ëŠ classì— í• ë‹¹í•  ê²ƒì¸ì§€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤. ì´ëŸ°ê±¸ closed-set ë¬¸ì œë¼ê³  í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì§€ë‚œ í¬ìŠ¤íŠ¸ì—ì„œ ì–¸ê¸‰í–ˆë˜ face recognitionê³¼ ê°™ì€ ê²½ìš° í•™ìŠµë˜ì§€ ì•Šì€ ì–¼êµ´ì„ ì–´ë–»ê²Œ ì¸ì‹í•  ê²ƒì¸ì§€ì˜ ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤. í• ë‹¹í•  classê°€ ì—†ê¸° ë•Œë¬¸ì— FaceNetì—ì„œëŠ” probe faceë¥¼ galleryì— ìˆëŠ” ì–¼êµ´ë“¤ê³¼ ë¹„êµí•˜ê¸° ìœ„í•œ low-dimensional embeddingì„ tripletì„ êµ¬ì„±í•˜ì—¬ í•™ìŠµì‹œì¼°ë˜ ê²ƒì„ ê¸°ì–µí•˜ì‹¤ ê²ƒì…ë‹ˆë‹¤. ì´ëŸ°ê±¸ open-set ë¬¸ì œë¼ê³  í•˜ëŠ”ë°ìš”, ê²°êµ­ open-set face recognitionì€ â€˜real domainì—ì„œ ë‹¤ë¥¸ ì–¼êµ´ì´ë¼ë©´ feature spaceì—ì„œë„ ë‹¤ë¥¸ ì–¼êµ´ì´ë¼ê³  ì¸ì‹í•˜ëŠ”â€™ê²ƒì„ í•™ìŠµí•˜ëŠ” ê²ƒì´ê³ , ë‹¤ë¥´ê²Œ í‘œí˜„í•œë‹¤ë©´ face imageë¥¼ feature spaceë¡œ mappingí•˜ê¸° ìœ„í•œ metricì„ í•™ìŠµí•˜ëŠ” ë¬¸ì œë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ feature spaceëŠ” ì„œë¡œ ë‹¤ë¥¸ ì–¼êµ´ë“¤ì— ëŒ€í•œ êµ¬ë¶„ë ¥ì„ ìµœëŒ€í™”í•´ì•¼ í•  ê²ƒì´ë¯€ë¡œ discriminative marginì„ ìµœëŒ€í™”í•˜ëŠ” ë°©í–¥ìœ¼ë¡œì˜ mapping metricì„ ë°°ì›Œì•¼ í•©ë‹ˆë‹¤.</p>

<p><img src="https://jiryang.github.io/img/closedset_vs_openset.PNG" alt="Fig1" title="Closed vs Open-Set Face Recognition" width="70%" class="aligncenter" /></p>

<p>Discriminative featureë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ë°°ì›Œë³´ìëŠ” ë‘ ê°€ì§€ ì‹œë„ê°€ ìš°ì„  ìˆì—ˆìŠµë‹ˆë‹¤.<br /></p>

<p><strong>Contrastive Loss</strong><br />
Contrastive loss(ë˜ëŠ” pairwise ranking loss)ëŠ” anchor-positive, anchor-negative pairë¥¼ êµ¬ì„±í•´ì„œ ê° ì´ë¯¸ì§€ë¥¼ Siamese networkì— ì§‘ì–´ë„£ì–´ ë‚˜ì˜¨ featureë“¤ì„ ì´ìš©í•˜ì—¬ ë‹¤ìŒì˜ lossë¥¼ ìµœì í™”í•˜ê²Œ ë©ë‹ˆë‹¤:<br />
\(L_{contrasive} = (1-Y) \frac 1 2 (\Vert f(x^i) - f(x^j) \Vert)^2 + Y \frac 1 2{max(0, m - \Vert f(x^i) - f(x^j) \Vert)}^2\)<br />
\(Y\): ë°”ì´ë„ˆë¦¬ label (anchor-positiveì´ë©´ 0, anchor-negativeì´ë©´ 1)
\(f(x^i)\): anchor sample<br />
\(f(x^j)\): positive ë˜ëŠ” negative sample<br /><br />
ìœ„ ì‹ì—ì„œ \(f(x^i) \approx f(x^j)\) ì´ë©´ (anchor-positive setì´ë€ ì–˜ê¸°ê² ì£ ) \(Y\)ì˜ ê°’ì´ 0ì´ ë˜ì–´ì„œ ìœ„ loss ì‹ì˜ ì• í•­ë§Œ ë‚¨ê²Œ ë˜ë©°, anchor-positive ê°„ì˜ ë‹®ì€ ì •ë„ë§Œí¼ \((\Vert f(x^i) - f(x^j) \Vert)^2\)ì˜ ê°’ì´ ì‘ì•„ì ¸ì„œ ìµœì¢… lossëŠ” Mean Squared Error (MSE)ì™€ ê±°ì˜ ê°™ì•„ì§‘ë‹ˆë‹¤. ê·¸ ë°˜ëŒ€ë¡œ anchor-negativeì˜ ê²½ìš°ì—ëŠ” loss ì‹ì˜ ë’· í•­ë§Œ ë‚¨ê²Œ ë˜ê³ , ì´ ë•Œì—ë„ ë§ˆì°¬ê°€ì§€ë¡œ anchor-negativeì˜ ë‹®ì€ ì •ë„ë§Œí¼ \((\Vert f(x^i) - f(x^j) \Vert)^2\)ì˜ ê°’ì´ ì‘ì•„ì§€ê¸´ í•˜ì§€ë§Œ ì°¨ì´ê°€ ì‘ìœ¼ë©´ ì‘ì„ìˆ˜ë¡ lossê°’ì€ \(\frac 1 2 m^2\)ì— ê·¼ì ‘í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ mì´ anchor-negative pairì— ëŒ€í•œ margin ì—­í• ì„ í•˜ëŠ”ê±°ì£ .</p>

<p><img src="https://jiryang.github.io/img/contrastive_loss_faces.png" alt="Fig2" title="Contrastive Loss" width="70%" class="aligncenter" /></p>

<p><strong><em>FaceNet</em> ì˜ Triplet Loss</strong><br />
Triplet lossì— ëŒ€í•´ì„œëŠ” <a href="https://jiryang.github.io/2020/05/23/FaceNet-and-one-shot-learning/">ì§€ë‚œ í¬ìŠ¤íŠ¸</a>ì—ì„œ ì„¤ëª…ë“œë¦° ë°” ìˆìŠµë‹ˆë‹¤. \(d(A, P) &lt; d(A, N) &lt; d(A, P)+\alpha\) ì¡°ê±´ì„ ì¶”ê°€í•˜ì—¬ì„œ discriminative powerë¥¼ ì¢€ ë” ê°•í™”í•˜ì˜€ì£ .</p>

<p><strong><em>SphereFace</em> ì˜ Angular Loss</strong><br />
Contrastiveì™€ triplet loss ëª¨ë‘ ê¸°ì¡´ì˜ softmax lossë¥¼ ê°œì„ í•˜ì—¬ latent representationì˜ discriminativenessë¥¼ ê°•í™”í•˜ê³  ì´ì— ë”°ë¥¸ marginì„ ì¶”ê°€ë¡œ í•™ìŠµí•˜ì˜€ì§€ë§Œ, ì—¬ì „íˆ Euclidean spaceì—ì„œì˜ distanceë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ì˜ ë©€ê³  ê°€ê¹Œì›€ì„ ê³„ì‚°í•˜ì˜€ë‹¤ëŠ” ì ì€ ë³€í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Center lossë¥¼ ì •ì˜í•œ ë…¼ë¬¸ì—ì„œ MNIST ë°ì´í„°ë¡œ softmax ê¸°ë°˜ classifierë¥¼ í•™ìŠµí•˜ê³  1st, 2nd layer activationì„ plotí•´ ë³¸ ê²°ê³¼ì—ì„œë„ ë‚˜íƒ€ë‚¬ì§€ë§Œ, ì´í›„ CASIA face datasetì„ softmax ë° normalized softmax (modified softmax) ê¸°ë°˜ìœ¼ë¡œ í•™ìŠµí•œ featureë¥¼ plotí•´ ë³¸ ê²°ê³¼ ì´ featureë“¤ì´ angularí•œ íŠ¹ì„±ì„ ê°€ì§€ê³  ìˆë‹¤ëŠ” ê²ƒì„ ê´€ì°°í•˜ê³ , ìì—°íˆ Euclideanì´ ì•„ë‹Œ Euler spaceì—ì„œì˜ distance ê¸°ë°˜ marginì„ ì°¾ì•„ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<p><img src="https://jiryang.github.io/img/mnist_first_layers.PNG" alt="Fig3" title="First Layers Activations of MNIST Classfier" width="70%" class="aligncenter" /></p>

<p>ì•„ë˜ ê·¸ë¦¼ì„ ë³´ì‹œë©´ CASIA face datasetì„ ì‚¬ìš©, (1) classifierë¥¼ softmaxë¡œ í•™ìŠµí•œ featureë¥¼ Euclidean spaceì— plotí•œ ê²ƒ; (2) (1)ì„ Euler spaceì— plot; (3) modified softmax (normalized)ë¡œ í•™ìŠµí•œ featureì˜ Euclidean plot; (4) (3)ì˜ Eulerian plot; (5) angular softmaxë¡œ í•™ìŠµí•œ featureì˜ Euclidean plot; (6) (5)ì˜ Eulerian plot ì„ ì˜ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤. ê° Euclidean plotì—ëŠ” decision boundaryê°€ x=0 ìœ¼ë¡œ ë‚˜ì™€ìˆê³ , Eulerian plotë“¤ì—ëŠ” angular bisectorê°€ ë³„ë„ë¡œ í‘œì‹œë˜ì–´ ìˆìŠµë‹ˆë‹¤. Euclideanë³´ë‹¤ Eulerianì˜ intra-class compactness ë° intra-class dispensionì´ ë” í¬ê³ , ê·¸ ì¤‘ì—ì„œë„ angular softmaxë¥¼ ì‚¬ìš©í•œ (6)ì˜ classê°„ discriminitive powerê°€ ê°€ì¥ í¬ë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><img src="https://jiryang.github.io/img/casia_face_angular_softmax.PNG" alt="Fig4" title="Comparison of Features Learned Using Softmax and A-Softmax Loss" width="100%" class="aligncenter" /></p>

<p>SphereFaceì˜ A-Softmax ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:<br />
\(L_{SphereFace} = -\frac 1 N \sum log(\frac {e^{\Vert x_i \Vert cos(m\theta_{y_i}, i)}} {e^{\Vert x_i \Vert cos(m\theta_{y_i}, i)+\sum_{j \neq y_i}e^{\Vert x_i \Vert cos(\theta_j, i)}}})\)</p>

<p><strong><em>CosFace</em> ì˜ Angular Loss</strong><br />
SphereFaceê°€ ê°ë„ ê°’ì— ê³±ìœ¼ë¡œ margin (multiplicative angular margin, ìœ„ ì‹ì˜ $\theta$ ì•ì— ë¶™ì€ \(m\))ì„ ì£¼ì—ˆëŠ”ë°ìš”, ì´ decision boundaryëŠ” ì•„ë˜ ê·¸ë¦¼ì˜ 3ë²ˆì§¸ â€˜A-Softmaxâ€™ì™€ ê°™ì´ Euler spaceì—ì„œì˜ vectorë¡œ í‘œì‹œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ìœ„ ê·¸ë¦¼ì˜ (6)ê³¼ ë™ì¼í•œê²ë‹ˆë‹¤). A-Softmaxì˜ ê²½ìš° \(\Vert \theta_1 - \theta_2 \Vert\) ê°’ì— ë”°ë¼ íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œëœ decision marginì´ ë³€í•œë‹¤ëŠ” ì  ë•Œë¬¸ì—, C1ê³¼ C2ê°€ ìœ ì‚¬í•˜ë‹¤ë©´ (ì–¼êµ´ì´ ë¹„ìŠ·í•˜ë‹¤ë©´) marginì´ ì‘ì•„ì§€ëŠ” ë‹¨ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ë˜í•œ gradient ê³„ì‚°ì„ ìš©ì´í•˜ê²Œ í•˜ê¸° ìœ„í•´ A-Softmaxì˜ $m$ì€ ì •ìˆ˜ì—¬ì•¼ í•œë‹¤ëŠ” í° ë‹¨ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤. Marginì´ í° ê°’ìœ¼ë¡œ ë³€ê²½ë˜ê¸° ë•Œë¬¸ì— ëª¨ë¸ì„ ìˆ˜ë ´ì‹œí‚¤ê¸° ì–´ë µê²Œ ëœ ê²ƒì´ì£ . Class similarityì™€ ë¬´ê´€í•˜ê²Œ constantí•œ marginì„ ë³´ì¥í•´ì£¼ê³ , ìˆ˜ë ´ì„ ìœ„í•´ ê¸°ì¡´ softmax lossì˜ ë„ì›€ì´ í•„ìš”ì—†ë„ë¡ additive angular marginì„ ì£¼ëŠ” lossë¥¼ ë§Œë“  ê²ƒì´ CosFaceì…ë‹ˆë‹¤ (ì•„ë˜ ê·¸ë¦¼ì˜ Large Margin Cosine Loss, LMCL).</p>

<p><img src="https://jiryang.github.io/img/decision_margin_comparison01.PNG" alt="Fig5" title="Comparison of Decision Margins" width="100%" class="aligncenter" /></p>

<p>CosFaceì˜ LMCL formulaì…ë‹ˆë‹¤. LMCLì˜ additive angular marginì„ SphereFaceì˜ multiplicative angular marginê³¼ ë¹„êµí•´ì„œ ë³´ì‹œì£ :<br />
\(L_{CosFace} = -\frac 1 N \sum_i log(\frac {e^{s(cos(\theta_{y_i}, i)-m)}} {e^{s(cos(\theta_{y_i}, i)-m)}+\sum_{j \neq y_i}e^{s(cos(\theta_j, i)-m)}})\)</p>

<p><strong><em>ArcFace</em> ì˜ Angular Loss</strong><br />
ArcFaceëŠ” additive cosine marginì„ ì´ìš©í•©ë‹ˆë‹¤ (CosFaceëŠ” additive angular marginì´ì—ˆì£ ). Logitì— \(arccos\)í•¨ìˆ˜ë¥¼ ì”Œì›Œì„œ similarityê°€ ì•„ë‹Œ ì‹¤ì œ angle (angular distance)ì„ ë½‘ê³ , ì—¬ê¸°ì— margin penaltyë¥¼ ë”í•œ í›„ \(cos\)í•¨ìˆ˜ë¡œ logitì„ ë³µì›í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ì„œ ArcFaceë¼ê³  ì´ë¦„ì§€ì—ˆìŠµë‹ˆë‹¤. Normalized ëœ hypersphere manifold ìƒì—ì„œ distanceë¥¼ ê°€ì§€ê³  inter-class dispersion, intra-class compactnessë¥¼ maximizeí•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— geodesic distanceì™€ ì¼ì¹˜í•˜ëŠ” angular marginì„ ì‚¬ìš©í•œë‹¤ëŠ” ì ì€ í•™ìŠµì— ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤. ì•„ë˜ angular planeì—ì„œì˜ decision boundaryëŠ” ì´ì™€ ê°™ì€ ArcFaceì˜ ì¥ì ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì•ì„œ ë³´ì•˜ë˜ decision marginê³¼ ë¹„êµí•´ë³´ë©´ CosFaceì˜ ê²½ìš° \(cos\theta\)ë¥¼ axesë¡œ ë†“ê³  ê·¸ë ¸ë˜ decision marginì„ angular (\(\theta\)) planeì— ê·¸ë ¤ë³´ë‹ˆ ì¼ì •í•˜ì§€ ì•Šê²Œ ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°˜ë©´ ArcFaceì˜ decision marginì€ angleì´ ë³€í•¨ì— ë”°ë¼ constant í•˜ì§€ìš”.</p>

<p><img src="https://jiryang.github.io/img/decision_margin_comparison02.PNG" alt="Fig6" title="Comparison of Decision Margins" width="100%" class="aligncenter" /></p>

<p>ArcFaceì˜ loss formulaì…ë‹ˆë‹¤. \(cos\)ë¥¼ ë²—ê²¨ì„œ marginì„ ë„£ê³  ë‹¤ì‹œ \(cos\)ë¥¼ ì”Œì›Œì£¼ì—ˆê¸° ë•Œë¬¸ì— LMCLê³¼ ë‹¬ë¦¬ additive marginì´ \(cos\)í•¨ìˆ˜ ì•ˆì— ë“¤ì–´ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:<br />
\(L_{ArcFace} = -\frac 1 N \sum_i log(\frac {e^{s(cos(\theta_{y_i}+m))}} {e^{s(cos(\theta_{y_i}+m))}+\sum_{j=1,j \neq y_i}e^{scos\theta_j}})\)</p>

<p>CASIA, LFW ë“± ë‹¤ì–‘í•œ face datasetì—ì„œ ë™ì¼í•œ ëª¨ë¸ë¡œ í…ŒìŠ¤íŠ¸í•œ ê²°ê³¼ ArcFaceëŠ” ê¸°ì¡´ Euclidean spaceì˜ softmaxê¸°ë°˜ ë°©ì‹ë“¤ë³´ë‹¤ë„, angular spaceì˜ ì—¬íƒ€ ì†”ë£¨ì…˜ë“¤ë³´ë‹¤ ë” ì¢‹ì€ ì„±ì ì„ ê±°ë‘ì—ˆìŠµë‹ˆë‹¤ (ë” ë§ì€ ê²°ê³¼ëŠ” ë…¼ë¬¸ì—ì„œ í™•ì¸).</p>

<p><img src="https://jiryang.github.io/img/arcface_comparative_result.png" alt="Fig7" title="Comparision of Verification Results" width="70%" class="aligncenter" /></p>

<p>Normalizeëœ angular spaceì—ì„œ ìš°ìˆ˜í•œ ì„±ëŠ¥ì„ ë³´ì´ëŠ” ArcFaceëŠ” scale-invariant, rotational-invariantí•œ íŠ¹ì„± ë•Œë¬¸ì— face ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ image dataì˜ open-set recognitionì— í™œìš©ì´ ê°€ëŠ¥í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë§ˆì¹¨ EstSoftì—ì„œ ArcFaceë¡œ Kaggle competitionì— ì…ìƒí–ˆë‹¤ëŠ” ê¸€ë„ ìˆë„¤ìš” (<a href="https://blog.estsoft.co.kr/727">ë§í¬</a>).</p>

<p>ìµœê·¼ì— ë‚˜ì˜¨ CurricularFaceê¹Œì§€ ì–¸ê¸‰í•˜ë©´ì„œ curriculum learning ì´ì•¼ê¸°ë¥¼ ì‹œì‘í•´ë†“ì„ê¹Œ í–ˆëŠ”ë° ë„ˆë¬´ ê¸¸ì–´ì§€ë„¤ìš”. ë‹¤ìŒì„ ê¸°ì•½í•©ë‹ˆë‹¤.</p>

<p>ë…¼ë¬¸ë§í¬: 
<a href="https://arxiv.org/pdf/1704.08063.pdf">SphereFace</a>
<a href="https://arxiv.org/pdf/1801.09414.pdf">CosFace</a>
<a href="https://arxiv.org/pdf/1801.07698.pdf">ArcFace</a>
<a href="https://arxiv.org/pdf/2004.00288.pdf">CurricularFace</a></p>
:ET